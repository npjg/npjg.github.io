<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Settling the score :: BitDust</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Google Summer of Code 2020 officially started today, although throughout May I worked regularly on the Macromedia Director engine&amp;rsquo;s rendering pipeline. In the middle of May I replaced the long-standing frame-based renderer &amp;ndash; which redrew the entire screen every frame &amp;ndash; with a channel-based approach. This first part of the project brought me in touch with most of the other ScummVM Director devs, which was a nice touch for GSoC&amp;rsquo;s Community Bonding Period." />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="/posts/gsoc-2020/settling-the-score/" />





  
  <link rel="stylesheet" href="/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css">

  
  <link rel="stylesheet" href="/css/code.min.00125962708925857e7b66dbc58391d55be1191a3d0ce2034de8c9cd2c481c36.css">

  
  <link rel="stylesheet" href="/css/fonts.min.90c955c31dd7c0e05aae3d4f583d4d8a2af799d69c961337eaf2a825063a55dd.css">

  
  <link rel="stylesheet" href="/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="/css/main.min.1d8be2dd1b5de9fdaed058c8c59fcf4485f36619574abfb47ed0cfda4812c16d.css">

  
  <link rel="stylesheet" href="/css/menu.min.83637a90d903026bc280d3f82f96ceb06c5fc72b7c1a8d686afb5bbf818a29f7.css">

  
  <link rel="stylesheet" href="/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="/css/post.min.fc74ca360273c1d828da3c02b8174eba435607b369d98418ccc6f2243cd4e75d.css">

  
  <link rel="stylesheet" href="/css/prism.min.9023bbc24533d09e97a51a0a42a5a7bfe4c591ae167c5551fb1d2191d11977c0.css">

  
  <link rel="stylesheet" href="/css/syntax.min.cc789ed9377260d7949ea4c18781fc58959a89287210fe4edbff44ebfc1511b6.css">

  
  <link rel="stylesheet" href="/css/terminal.min.5f8d3abeb8d98606857840dd0698f3c9fd8ba2e4f84ede3e24ee66f68d74ccba.css">

  
  <link rel="stylesheet" href="/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">


<link rel="stylesheet" href="/terminal.css">




<link rel="shortcut icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="Nathanael Gentry" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Settling the score">
<meta property="og:description" content="Google Summer of Code 2020 officially started today, although throughout May I worked regularly on the Macromedia Director engine&amp;rsquo;s rendering pipeline. In the middle of May I replaced the long-standing frame-based renderer &amp;ndash; which redrew the entire screen every frame &amp;ndash; with a channel-based approach. This first part of the project brought me in touch with most of the other ScummVM Director devs, which was a nice touch for GSoC&amp;rsquo;s Community Bonding Period." />
<meta property="og:url" content="/posts/gsoc-2020/settling-the-score/" />
<meta property="og:site_name" content="BitDust" />

  <meta property="og:image" content="/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2020-06-01 21:10:00 -0400 EDT" />












</head>
<body>


<div class="container full">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    BitDust
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;â–¾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="https://www.youtube.com/@nathanaelgentrymusic">Music</a></li>
        
      
        
          <li><a href="/posts">Posts</a></li>
        
      
        
          <li><a href="https://www.youtube.com/@retrobitdust">YouTube</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about" >About</a></li>
        
      
        
          <li><a href="https://www.youtube.com/@nathanaelgentrymusic" >Music</a></li>
        
      
        
          <li><a href="/posts" >Posts</a></li>
        
      
        
          <li><a href="https://www.youtube.com/@retrobitdust" >YouTube</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="/posts/gsoc-2020/settling-the-score/">Settling the score</a>
  </h1>
  <div class="post-meta"><time class="post-date">2020-06-01[Updated::2020-08-25]</time><span class="post-author">Nathanael Gentry</span><span class="post-reading-time">3 min read (565 words)</span></div>

  
    <span class="post-tags">
      
      #<a href="/tags/macromedia-director/">Macromedia Director</a>&nbsp;
      
      #<a href="/tags/google-summer-of-code-2020/">Google Summer of Code 2020</a>&nbsp;
      
      #<a href="/tags/scummvm/">ScummVM</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <p>Google Summer of Code 2020 officially started today, although throughout May I
worked regularly on the Macromedia Director engine&rsquo;s rendering pipeline. In the
middle of May I replaced the long-standing frame-based renderer &ndash; which redrew
the entire screen every frame &ndash; with a channel-based approach. This first part
of the project brought me in touch with most of the other ScummVM Director devs,
which was a nice touch for GSoC&rsquo;s Community Bonding Period.</p>
<p>Modern operating systems use a desktop metaphor, with folders and notepads and
option drawers. Director uses a cinematic metaphor, which works like this: Each
movie has some cast members (shapes, bitmaps, text, etc.) which can be
instantiated as sprites to appear on the stage (user viewing area). Each sprite
inhabits a channel in the score. Rather confusingly, in fact, the terms <em>sprite</em>
and <em>channel</em> are almost used interchangeably. One channel can display many
different cast members throughout a movie. As you can see, this jargon (I dare
not say lingo) departs from the usual understanding of <em>sprite</em>.</p>
<p>Just as its musical connotation implies, the
score compactly describes the activity of each sprite and provides ready
access to Lingo scripts and other customizations.</p>
<p><img src="/posts/gsoc-2020/settling-the-score/settling-the-score-1.png"></p>
<p>As you might imagine from this screenshot of a Director 4 (1994) score, scores can be
viewed as large matrices indexed by frames on the vertical and channels on the
horizontal. Each entry (cell) of this matrix thus describes one item on
stage at one point in time. On each frame, Director draws the sprites in
ascending channel order.</p>
<p>At first, I naively thought that like Photoshop I could just toggle &ldquo;layers&rdquo;
and be on my way. I quickly discovered, however, that in Director this
convenience was exactly the functionality that we lacked. The score needed keep
track of exactly what sprites were on stage at any given moment. It would no
longer be enough to blindly draw whatever the current frame said its sprites
were. Our engine needed to think more horizontally, rather than vertically.</p>
<p>After creating numerous test movies to understand Director&rsquo;s rendering rules, I
devised a simple mask-based approach. I took stock of all the dirty areas of the
screen and just iterated over the channels to redraw the parts of sprites that
intersected there. Nothing could be simpler, but it took me quite a while to
understand all the eccentricities of the code and complete the refactoring
required to get the engine alive again.</p>
<p>My approach gives fairly complete consistency with the original. Many difficult
commands, like <code>zoomBox</code>, can now work properly. Moreover, my work enabled
puppeted sprites &ndash; sprites controlled by Lingo, and not by the instructions in
the score &ndash; to work properly. If a sprite is puppeted, its channel in the score
is simply not updated with sprites from new frames. The same sprite stays on
stage until its puppet is disabled. This was not possible when every frame
brought a new set of sprites to draw. But it was trivial when the
score kept track of channels and sprites and chose when to update and redraw them.</p>
<p>My changes did not enhance much visually &ndash; in fact, there was a regression that
drew hideous white boxes instead of transparent hotspots. However,
this morning I got to the bottom of those issues, and now Captain Hammer looks
as fearsome as ever.</p>
<p><img src="/posts/gsoc-2020/settling-the-score/settling-the-score-2.png"></p>
<p>Stay tuned for my adventures with QuickDraw and our Macintosh GUI emulator!</p>

      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">Read other posts</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
      <a href="/posts/gsoc-2020/widget-weeds/widget-weeds/" class="button inline prev">
        In the widget weeds
      </a>
    
    
      ::
    
    
      <a href="/posts/gsoc-2020/macromedia-mysteries/" class="button inline next">
        Macromedia mysteries
      </a>
    
  </div>
</div>


  

  
    

<div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "bitdust-1" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>Â© 2024 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
