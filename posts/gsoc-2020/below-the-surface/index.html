<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Below the surface :: BitDust</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="This week, I worked on implementing a few Lingo commands that required some significant backend work, but not much in the rendering code where I have spent so much of my time. I mentioned that I had worked on a custom cursor implementation, and I spent the first part of the week fixing bugs there. Now cursor bitmaps like the starfish on the island are properly displayed at the proper position, whereas after my initial work just a black box showed." />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="/posts/gsoc-2020/below-the-surface/" />





  
  <link rel="stylesheet" href="/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css">

  
  <link rel="stylesheet" href="/css/code.min.00125962708925857e7b66dbc58391d55be1191a3d0ce2034de8c9cd2c481c36.css">

  
  <link rel="stylesheet" href="/css/fonts.min.90c955c31dd7c0e05aae3d4f583d4d8a2af799d69c961337eaf2a825063a55dd.css">

  
  <link rel="stylesheet" href="/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="/css/main.min.1d8be2dd1b5de9fdaed058c8c59fcf4485f36619574abfb47ed0cfda4812c16d.css">

  
  <link rel="stylesheet" href="/css/menu.min.83637a90d903026bc280d3f82f96ceb06c5fc72b7c1a8d686afb5bbf818a29f7.css">

  
  <link rel="stylesheet" href="/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="/css/post.min.fc74ca360273c1d828da3c02b8174eba435607b369d98418ccc6f2243cd4e75d.css">

  
  <link rel="stylesheet" href="/css/prism.min.9023bbc24533d09e97a51a0a42a5a7bfe4c591ae167c5551fb1d2191d11977c0.css">

  
  <link rel="stylesheet" href="/css/syntax.min.cc789ed9377260d7949ea4c18781fc58959a89287210fe4edbff44ebfc1511b6.css">

  
  <link rel="stylesheet" href="/css/terminal.min.5f8d3abeb8d98606857840dd0698f3c9fd8ba2e4f84ede3e24ee66f68d74ccba.css">

  
  <link rel="stylesheet" href="/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">


<link rel="stylesheet" href="/terminal.css">




<link rel="shortcut icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="Nathanael Gentry" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Below the surface">
<meta property="og:description" content="This week, I worked on implementing a few Lingo commands that required some significant backend work, but not much in the rendering code where I have spent so much of my time. I mentioned that I had worked on a custom cursor implementation, and I spent the first part of the week fixing bugs there. Now cursor bitmaps like the starfish on the island are properly displayed at the proper position, whereas after my initial work just a black box showed." />
<meta property="og:url" content="/posts/gsoc-2020/below-the-surface/" />
<meta property="og:site_name" content="BitDust" />

  <meta property="og:image" content="/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2020-07-28 00:07:00 -0400 EDT" />












</head>
<body>


<div class="container full">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    BitDust
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="https://www.youtube.com/@nathanaelgentrymusic">Music</a></li>
        
      
        
          <li><a href="/posts">Posts</a></li>
        
      
        
          <li><a href="https://www.youtube.com/@retrobitdust">YouTube</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about" >About</a></li>
        
      
        
          <li><a href="https://www.youtube.com/@nathanaelgentrymusic" >Music</a></li>
        
      
        
          <li><a href="/posts" >Posts</a></li>
        
      
        
          <li><a href="https://www.youtube.com/@retrobitdust" >YouTube</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="/posts/gsoc-2020/below-the-surface/">Below the surface</a>
  </h1>
  <div class="post-meta"><time class="post-date">2020-07-28[Updated::2020-08-25]</time><span class="post-author">Nathanael Gentry</span><span class="post-reading-time">3 min read (628 words)</span></div>

  
    <span class="post-tags">
      
      #<a href="/tags/macromedia-director/">Macromedia Director</a>&nbsp;
      
      #<a href="/tags/google-summer-of-code-2020/">Google Summer of Code 2020</a>&nbsp;
      
      #<a href="/tags/scummvm/">ScummVM</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <p>This week, I worked on implementing a few Lingo commands that required some
significant backend work, but not much in the rendering code where I have spent
so much of my time. I mentioned that I had worked on a custom cursor
implementation, and I spent the first part of the week fixing bugs there. Now
cursor bitmaps like the starfish on the island are properly displayed at the
proper position, whereas after my initial work just a black box showed.</p>
<p><img src="/posts/gsoc-2020/below-the-surface/below-the-surface-2.png"></p>
<p>Early in the week, I fixed a subtle rendering bug that had plagued Spaceship
Warlock for a while. You&rsquo;ve seen how the Stambulian policemen in Warlock were
bright green; well, this was about the same as the keying colour that the MacGUI
was using for border transparency. Once I spotted this, the fix was easy &ndash; and
also prevented a redundant surface copy. (Yay for performance improvements!)
Here you can see how the erroneously applied transparency actually gave a nice look to an
otherwise bland wall in Stambul:</p>
<p><img src="/posts/gsoc-2020/below-the-surface/below-the-surface-3.png"></p>
<p>I also finished the implementation of custom colour palettes. For a long while
the opening to Chop Suey looked all psychedelic. It turns out that a recent
refactoring swapped around the order of palette loading so ScummVM was given the
wrong palette to use. My partial fix for this revealed that our recently-added
target Majestic used a castmember palette, which had been loaded before &ndash;
albeit improperly. So over the weekend I expanded our Director palette manager
to support custom palettes alongside the half-dozen default Mac ones. This also
brought along basic support for the <code>puppetPalette</code> command, which controls the
palette from Lingo. Now, Chop Suey and Majestic are looking quite handsome:</p>
<p><img src="/posts/gsoc-2020/below-the-surface/below-the-surface-1.png"></p>
<p>This project came later in the week, however. I first implemented sound fading,
which more intense than I first knew. Since multiple movies can be running at
once, my knee-jerk blocking fade loop didn&rsquo;t work out. Instead, I needed to
integrate the sound fade with the existing score stepping methods. I&rsquo;m amused
that that this was one of my largest commits for the week. (Thankfully, though,
transitions do seem to block in the original &ndash; <em>that</em> would be a pain to
refactor.)</p>
<p>Finally, I scratched my head for a while on an issue that @sev has since begun
looking into. An interesting Director target is Macromedia&rsquo;s own guided tour,
which takes you &ldquo;behind the scenes&rdquo; at their studios to introduce new features
of Director. Our renderer implicitly assumed that bitmap sprites had the same
dimensions as the underlying castmembers, unless the dimensions had been
modified from Lingo. Well, our smartly-dressed friend from
the guided tour dismissed that theory:</p>
<p><img src="/posts/gsoc-2020/below-the-surface/below-the-surface-4.png"></p>
<p>What&rsquo;s on the left is the original sprite (plus arms), and on right is the
original castmember. ScummVM draws them both the same size. I would never have
noticed, except that the sprite for his moving mouth appears all out of place
when he isn&rsquo;t the right size. Director does indeed have an option to scale
individual sprites in the score, and we were reading this information in for
bitmaps&hellip; but when I tried to use it there were puzzling discrepancies in the
dimensions we expected and what the file clearly said. I still haven&rsquo;t figured
out why.</p>
<p>It&rsquo;s been a good week over all, with interesting tasks both in and outside GSoC.
You&rsquo;ve perhaps seen on my bio that I like playing music. One of my friends
recruited me to play piano for her upcoming violin competition, so when I need a
break from coding I spend a few hours with the interesting sonorities of the
great American composer Samuel Barber. And, at university on the weekends, I am
working on using machine learning to control dielectric elastomers &ndash; smart
materials that show much promise for soft robotics.</p>

      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">Read other posts</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
      <a href="/posts/gsoc-2020/fresh-air/" class="button inline prev">
        Fresh air
      </a>
    
    
      ::
    
    
      <a href="/posts/gsoc-2020/lots-of-chop-suey/" class="button inline next">
        Lots of chop suey
      </a>
    
  </div>
</div>


  

  
    

<div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "bitdust-1" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2024 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
